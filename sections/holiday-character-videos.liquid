{% comment %}
  Holiday Character Videos Section
  Carousel displaying character skit videos one at a time with navigation
{% endcomment %}

<div class="holiday-character-videos section--padded" data-section-id="{{ section.id }}" data-section-type="holiday-character-videos">
  <div class="wrapper">
    {% if section.settings.title != blank %}
      <h2 class="section-title">{{ section.settings.title }}</h2>
    {% endif %}

    {% if section.settings.description != blank %}
      <div class="section-description rte">
        {{ section.settings.description }}
      </div>
    {% endif %}

    <div class="character-videos-carousel">
      <button class="carousel-nav carousel-prev" aria-label="Previous video">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>

      <div class="carousel-container">
        <div class="carousel-track">
          {% for block in section.blocks %}
            <div class="character-video-slide" data-slide="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
              <div class="character-video-item">
                {% if block.settings.video_url != blank %}
                  <div class="character-video-wrapper">
                    {% if block.settings.video_url contains 'youtube.com' or block.settings.video_url contains 'youtu.be' %}
                      {% assign video_id = block.settings.video_url | split: 'v=' | last | split: '&' | first %}
                      {% if block.settings.video_url contains 'youtu.be' %}
                        {% assign video_id = block.settings.video_url | split: 'youtu.be/' | last %}
                      {% endif %}
                      <iframe
                        src="https://www.youtube.com/embed/{{ video_id }}"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen
                        class="character-video-iframe"
                      ></iframe>
                    {% elsif block.settings.video_url contains 'vimeo.com' %}
                      {% assign video_id = block.settings.video_url | split: 'vimeo.com/' | last %}
                      <iframe
                        src="https://player.vimeo.com/video/{{ video_id }}"
                        frameborder="0"
                        allow="autoplay; fullscreen; picture-in-picture"
                        allowfullscreen
                        class="character-video-iframe"
                      ></iframe>
                    {% else %}
                      <video controls class="character-video-native">
                        <source src="{{ block.settings.video_url }}" type="video/mp4">
                        Your browser does not support the video tag.
                      </video>
                    {% endif %}
                  </div>
                {% else %}
                  {%- comment -%} Placeholder when no video is set {%- endcomment -%}
                  <div class="character-video-wrapper">
                    <div class="character-video-placeholder">
                      <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                      </svg>
                      <p>Video {{ forloop.index }}</p>
                    </div>
                  </div>
                {% endif %}

                {% if block.settings.character_name != blank %}
                  <h3 class="character-name">{{ block.settings.character_name }}</h3>
                {% endif %}

                {% if block.settings.character_description != blank %}
                  <p class="character-description">{{ block.settings.character_description }}</p>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <button class="carousel-nav carousel-next" aria-label="Next video">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <div class="carousel-dots">
      {% for block in section.blocks %}
        <button class="carousel-dot" data-slide="{{ forloop.index0 }}" aria-label="Go to video {{ forloop.index }}"></button>
      {% endfor %}
    </div>
  </div>
</div>

<style>
.holiday-character-videos {
  background-color: #2E7D32 !important;
  padding: 60px 0;
  position: relative;
  z-index: 1;
  width: 100%;
  clear: both;
}

.holiday-character-videos .wrapper {
  max-width: 100%;
  width: 100%;
  margin: 0 auto;
  padding: 0;
}

.holiday-character-videos .section-title {
  text-align: center;
  color: #ffffff !important;
  font-size: 42px;
  margin-bottom: 15px;
  font-weight: 800;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.holiday-character-videos .section-description {
  text-align: center;
  color: #ffffff !important;
  font-size: 18px;
  margin-bottom: 50px;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}

.character-videos-carousel {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 30px;
  max-width: 1000px;
  margin: 0 auto;
  position: relative;
}

.carousel-container {
  flex: 1;
  overflow: hidden;
  position: relative;
}

.carousel-track {
  display: flex;
  transition: transform 0.5s ease-in-out;
}

.character-video-slide {
  min-width: 100%;
  flex-shrink: 0;
}

.character-video-item {
  background: linear-gradient(135deg, rgba(46, 125, 50, 0.4) 0%, rgba(27, 94, 32, 0.4) 100%);
  border-radius: 20px;
  padding: 30px;
  border: 3px solid #F2BD35;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
  max-width: 700px;
  margin: 0 auto;
}

.character-video-wrapper {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 aspect ratio */
  height: 0;
  overflow: hidden;
  border-radius: 12px;
  margin-bottom: 25px;
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
  border: 3px solid rgba(242, 189, 53, 0.5);
}

.character-video-iframe,
.character-video-native {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 10px;
}

.character-video-placeholder {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(42, 42, 42, 0.95) 100%);
  color: #F2BD35;
  border-radius: 10px;
}

.character-video-placeholder svg {
  margin-bottom: 15px;
  opacity: 0.8;
  width: 100px;
  height: 100px;
  stroke: #F2BD35;
}

.character-video-placeholder p {
  color: #ffffff;
  font-size: 18px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1.5px;
}

.character-name {
  color: #ffffff !important;
  font-size: 28px;
  margin-bottom: 12px;
  text-align: center;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.character-description {
  color: #E8F5E9 !important;
  font-size: 16px;
  text-align: center;
  opacity: 0.95;
  line-height: 1.6;
  font-weight: 500;
}

/* Navigation Arrows */
.carousel-nav {
  background: linear-gradient(135deg, #F2BD35 0%, #E68819 100%);
  border: none;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  flex-shrink: 0;
}

.carousel-nav:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
  background: linear-gradient(135deg, #E68819 0%, #F2BD35 100%);
}

.carousel-nav:active {
  transform: scale(0.95);
}

.carousel-nav svg {
  color: #1a1a1a;
}

.carousel-nav:disabled {
  opacity: 0.3;
  cursor: not-allowed;
  transform: none;
}

/* Carousel Dots */
.carousel-dots {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 30px;
}

.carousel-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.4);
  border: 2px solid #F2BD35;
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
}

.carousel-dot:hover {
  background: rgba(242, 189, 53, 0.6);
  transform: scale(1.2);
}

.carousel-dot.active {
  background: #F2BD35;
  width: 16px;
  height: 16px;
  border-width: 3px;
}

/* Mobile: Smaller navigation */
@media (max-width: 768px) {
  .holiday-character-videos .section-title {
    font-size: 32px;
  }

  .holiday-character-videos .section-description {
    font-size: 16px;
  }

  .holiday-character-videos {
    padding: 40px 0;
  }

  .character-videos-carousel {
    gap: 15px;
    padding: 0 10px;
  }

  .carousel-nav {
    width: 50px;
    height: 50px;
  }

  .carousel-nav svg {
    width: 30px;
    height: 30px;
  }

  .character-video-item {
    padding: 20px;
  }

  .character-name {
    font-size: 22px;
  }

  .character-description {
    font-size: 14px;
  }
}
</style>

<script>
(function() {
  const section = document.querySelector('[data-section-type="holiday-character-videos"]');
  if (!section) return;

  const track = section.querySelector('.carousel-track');
  const slides = section.querySelectorAll('.character-video-slide');
  const prevBtn = section.querySelector('.carousel-prev');
  const nextBtn = section.querySelector('.carousel-next');
  const dots = section.querySelectorAll('.carousel-dot');

  let currentSlide = 0;
  const totalSlides = slides.length;

  function updateCarousel() {
    // Move track
    track.style.transform = `translateX(-${currentSlide * 100}%)`;

    // Update dots
    dots.forEach((dot, index) => {
      if (index === currentSlide) {
        dot.classList.add('active');
      } else {
        dot.classList.remove('active');
      }
    });

    // Update navigation buttons
    prevBtn.disabled = currentSlide === 0;
    nextBtn.disabled = currentSlide === totalSlides - 1;
  }

  function goToSlide(index) {
    if (index < 0 || index >= totalSlides) return;
    currentSlide = index;
    updateCarousel();
  }

  // Navigation buttons
  prevBtn.addEventListener('click', () => goToSlide(currentSlide - 1));
  nextBtn.addEventListener('click', () => goToSlide(currentSlide + 1));

  // Dots navigation
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => goToSlide(index));
  });

  // Initialize
  updateCarousel();
})();
</script>

{% schema %}
{
  "name": "Holiday Character Videos",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Meet Our Holiday Characters"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Section Description",
      "default": "<p>Watch our festive character skits!</p>"
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Character Video",
      "settings": [
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL",
          "info": "YouTube, Vimeo, or direct MP4 URL"
        },
        {
          "type": "text",
          "id": "character_name",
          "label": "Character Name",
          "default": "Character Name"
        },
        {
          "type": "textarea",
          "id": "character_description",
          "label": "Character Description",
          "default": "Brief description of this character"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Holiday Character Videos",
      "blocks": [
        {
          "type": "video",
          "settings": {
            "character_name": "Santa Claus",
            "character_description": "The big man himself shares his thoughts!"
          }
        },
        {
          "type": "video",
          "settings": {
            "character_name": "Rudolph",
            "character_description": "Our favorite red-nosed reindeer"
          }
        },
        {
          "type": "video",
          "settings": {
            "character_name": "Buddy the Elf",
            "character_description": "Straight from the North Pole!"
          }
        },
        {
          "type": "video",
          "settings": {
            "character_name": "The Grinch",
            "character_description": "Even he loves our Cranberry Vodka!"
          }
        }
      ]
    }
  ]
}
{% endschema %}
