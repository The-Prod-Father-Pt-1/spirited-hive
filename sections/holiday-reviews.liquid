{{ 'section-text-testimonials.min.css' | asset_url | stylesheet_tag }}

{% comment %}
  Holiday Reviews Section
  Purpose: Show funny character reviews during holiday season (Nov 1 - Dec 31)
  Auto-switches to real reviews on Jan 1
{% endcomment %}

{% comment %} Date Logic - Check if we're in holiday season {% endcomment %}
{% assign current_date = 'now' | date: '%Y-%m-%d' %}
{% assign holiday_start = section.settings.holiday_start_date | default: '2025-11-01' %}
{% assign holiday_end = section.settings.holiday_end_date | default: '2025-12-31' %}

{% assign is_holiday_season = false %}
{% if current_date >= holiday_start and current_date <= holiday_end %}
  {% assign is_holiday_season = true %}
{% endif %}

{% comment %} Override: Manual toggle from admin {% endcomment %}
{% if section.settings.force_holiday_mode %}
  {% assign is_holiday_season = true %}
{% endif %}
{% if section.settings.force_real_reviews %}
  {% assign is_holiday_season = false %}
{% endif %}

<div
  class="wrapper-spacing--v wrapper-spacing--h color-scheme--{{ section.settings.colors }}{% if section.settings.circle_images %} testimonial--circle-images{% endif %}"
  data-wetheme-section-type="holiday-reviews"
  data-wetheme-section-id="{{ section.id }}"
  data-holiday-mode="{{ is_holiday_season }}"
  style="--padding-section-top: {{ section.settings.section_padding_top }}px; --padding-section-bottom: {{ section.settings.section_padding_bottom }}px;"
>

<div class="wrapper width--content show-on-scroll">

  {% comment %} Section Header {% endcomment %}
  {% if is_holiday_season %}
    {% render 'dynamic-section-header' with
      section_title: section.settings.holiday_title,
      section_description: section.settings.holiday_description
    %}
  {% else %}
    {% render 'dynamic-section-header' with
      section_title: section.settings.real_reviews_title,
      section_description: section.settings.real_reviews_description
    %}
  {% endif %}

  <div class="testimonials-block">

    {% comment %} HOLIDAY REVIEWS - Show character reviews during holiday season {% endcomment %}
    {% if is_holiday_season %}

      {% for block in section.blocks %}
        {% if block.type == 'holiday_character' %}
          {%- assign testimonial_has_link = false -%}
          {% if block.settings.link != blank %}
            {%- assign testimonial_has_link = true -%}
          {% endif %}

          <div
            class="testimonial--single-item holiday-review"
            data-animate
            data-animate-order="{% render 'block-animation-offset',
            title: section.settings.holiday_title,
            description: section.settings.holiday_description,
            base: forloop.index
            %}"
            {{ block.shopify_attributes }}
          >

            {% if testimonial_has_link %}
              <a href="{{ block.settings.link }}">
            {% endif %}

            {% comment %} Character Avatar {% endcomment %}
            {% if block.settings.character_image != blank %}
              <div class="testimonial-section--image">
                {% render 'responsive-image' with block.settings.character_image, crop: 'center', default_size: '200x200', force_height: 200, force_aspect: 1, allow_stretch: true %}
              </div>
            {% endif %}

            {% if testimonial_has_link %}
              </a>
            {% endif %}

            {% comment %} Star Rating {% endcomment %}
            {% if block.settings.stars > 0 %}
              {% if testimonial_has_link %}
                <a href="{{ block.settings.link }}">
              {% endif %}

              <div class="testimonials--star-wrapper inline-icon--wrapper">
                {% assign star_total = block.settings.stars %}
                {% for i in (1..star_total) %}
                  {% render 'theme-icon' with icon: 'star-filled', iconAttributes: 'aria-hidden="true"', iconSize: 20 %}
                {% endfor %}
              </div>

              {% if testimonial_has_link %}
                </a>
              {% endif %}
            {% endif %}

            {% comment %} Review Text {% endcomment %}
            {% if block.settings.review_text != blank %}
              <div class="testimonials--text-wrapper text-inline-link-animated holiday-review__text">
                {{ block.settings.review_text }}
              </div>
            {% endif %}

            {% comment %} Character Name {% endcomment %}
            {% if block.settings.character_name != blank %}
              {% if testimonial_has_link %}
                <a href="{{ block.settings.link }}">
              {% endif %}

              <span class="h6 holiday-review__character">{{ block.settings.character_name | escape }}</span>

              {% if testimonial_has_link %}
                </a>
              {% endif %}
            {% endif %}

            {% comment %} Holiday Badge {% endcomment %}
            <div class="holiday-review__badge">
              ‚ùÑ Holiday Special Review
            </div>

          </div>
        {% endif %}
      {% endfor %}

    {% comment %} REAL REVIEWS - Show real customer reviews after holidays {% endcomment %}
    {% else %}

      {% for block in section.blocks %}
        {% if block.type == 'real_review' %}
          {%- assign testimonial_has_link = false -%}
          {% if block.settings.link != blank %}
            {%- assign testimonial_has_link = true -%}
          {% endif %}

          <div
            class="testimonial--single-item"
            data-animate
            data-animate-order="{% render 'block-animation-offset',
            title: section.settings.real_reviews_title,
            description: section.settings.real_reviews_description,
            base: forloop.index
            %}"
            {{ block.shopify_attributes }}
          >

            {% if testimonial_has_link %}
              <a href="{{ block.settings.link }}">
            {% endif %}

            {% if block.settings.image != blank %}
              <div class="testimonial-section--image">
                {% render 'responsive-image' with block.settings.image, crop: 'center', default_size: '200x200', force_height: 200, force_aspect: 1, allow_stretch: true %}
              </div>
            {% endif %}

            {% if testimonial_has_link %}
              </a>
            {% endif %}

            {% if block.settings.stars > 0 %}
              {% if testimonial_has_link %}
                <a href="{{ block.settings.link }}">
              {% endif %}

              <div class="testimonials--star-wrapper inline-icon--wrapper">
                {% assign star_total = block.settings.stars %}
                {% for i in (1..star_total) %}
                  {% render 'theme-icon' with icon: 'star-filled', iconAttributes: 'aria-hidden="true"', iconSize: 20 %}
                {% endfor %}
              </div>

              {% if testimonial_has_link %}
                </a>
              {% endif %}
            {% endif %}

            {% if block.settings.testimonial_text != blank %}
              <div class="testimonials--text-wrapper text-inline-link-animated">
                {{ block.settings.testimonial_text }}
              </div>
            {% endif %}

            {% if block.settings.customer_name != blank %}
              {% if testimonial_has_link %}
                <a href="{{ block.settings.link }}">
              {% endif %}

              <span class="h6">{{ block.settings.customer_name | escape }}</span>

              {% if testimonial_has_link %}
                </a>
              {% endif %}
            {% endif %}

          </div>
        {% endif %}
      {% endfor %}

    {% endif %}

  </div>

  {% comment %} Debug Info (only visible when debug mode enabled) {% endcomment %}
  {% if section.settings.show_debug_info %}
    <div style="margin-top: 2rem; padding: 1rem; background: #f0f0f0; border-radius: 8px; font-size: 0.875rem;">
      <strong>Debug Info:</strong><br>
      Current Date: {{ current_date }}<br>
      Holiday Start: {{ holiday_start }}<br>
      Holiday End: {{ holiday_end }}<br>
      Is Holiday Season: {{ is_holiday_season }}<br>
      Force Holiday Mode: {{ section.settings.force_holiday_mode }}<br>
      Force Real Reviews: {{ section.settings.force_real_reviews }}
    </div>
  {% endif %}

</div>

</div>

<style>
  /* Holiday theme - red background with white text */
  .section--holiday-reviews-wrapper {
    background: #DC143C !important;
  }

  /* White text for section headers and general content */
  .section--holiday-reviews-wrapper h1,
  .section--holiday-reviews-wrapper h2,
  .section--holiday-reviews-wrapper h3,
  .section--holiday-reviews-wrapper p:not(.holiday-review__text *),
  .section--holiday-reviews-wrapper .dynamic-section-header {
    color: #ffffff !important;
  }

  .holiday-review {
    position: relative;
    background: rgba(255, 255, 255, 0.1);
    padding: 2rem;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
  }

  .holiday-review__text,
  .holiday-review__text * {
    font-style: italic;
    color: #000000 !important; /* Black text on white card background */
  }

  .holiday-review__character {
    color: #ffffff !important;
    font-weight: 700;
    background: #000000;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    display: inline-block;
    margin-top: 0.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .section--holiday-reviews-wrapper .holiday-review__badge,
  .section--holiday-reviews-wrapper .holiday-review__badge * {
    margin-top: 1rem;
    font-size: 0.75rem;
    color: #000000 !important; /* Black text for visibility on white badge */
    background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    display: inline-block;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  /* Star ratings - white on red */
  .testimonials--star-wrapper svg {
    color: #ffffff !important;
    fill: #ffffff !important;
  }

  /* Mobile - horizontal scroll */
  @media (max-width: 768px) {
    .testimonials-block {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none; /* Hide scrollbar Firefox */
      padding: 0 1rem 1rem 1rem;
      margin: 0 -1rem;
    }

    .testimonials-block::-webkit-scrollbar {
      display: none; /* Hide scrollbar Chrome/Safari */
    }

    .testimonial--single-item {
      min-width: 85vw;
      flex-shrink: 0;
      scroll-snap-align: center;
    }

    .holiday-review {
      padding: 1.5rem;
    }

    .holiday-review__badge {
      font-size: 0.7rem;
      padding: 0.4rem 0.8rem;
    }

    .testimonials--star-wrapper {
      margin: 0.75rem 0;
    }
  }

  /* Tablet */
  @media (min-width: 769px) and (max-width: 1024px) {
    .testimonials-block {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }
  }

  /* Desktop - Auto-scrolling animation */
  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(calc(-400px * 9 - 2rem * 9));
    }
  }

  @media (min-width: 1025px) {
    .testimonials-block {
      overflow: hidden;
      position: relative;
      display: flex;
      gap: 2rem;
      animation: scroll 120s linear infinite;
    }

    .testimonials-block:hover {
      animation-play-state: paused;
    }

    .testimonial--single-item {
      min-width: 400px;
      flex-shrink: 0;
    }

    .holiday-review {
      height: 100%;
    }

    .holiday-review:hover {
      transform: translateY(-4px);
      transition: transform 0.3s ease;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }
  }
</style>

<script>
  // Duplicate reviews for seamless infinite scroll
  document.addEventListener('DOMContentLoaded', function() {
    const testimonialsBlock = document.querySelector('[data-wetheme-section-type="holiday-reviews"] .testimonials-block');

    if (testimonialsBlock && window.innerWidth >= 1025) {
      // Clone all review items
      const reviews = Array.from(testimonialsBlock.children);

      // Duplicate items 3 times for seamless loop
      reviews.forEach(review => {
        const clone1 = review.cloneNode(true);
        const clone2 = review.cloneNode(true);
        const clone3 = review.cloneNode(true);
        testimonialsBlock.appendChild(clone1);
        testimonialsBlock.appendChild(clone2);
        testimonialsBlock.appendChild(clone3);
      });
    }
  });
</script>

{% schema %}
{
  "name": "Holiday Reviews",
  "class": "section--holiday-reviews-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Date Settings"
    },
    {
      "type": "paragraph",
      "content": "This section automatically switches between holiday character reviews and real reviews based on the date. Holiday reviews show from Nov 1 - Dec 31, real reviews show all other times."
    },
    {
      "type": "text",
      "id": "holiday_start_date",
      "label": "Holiday Start Date",
      "default": "2025-11-01",
      "info": "Format: YYYY-MM-DD"
    },
    {
      "type": "text",
      "id": "holiday_end_date",
      "label": "Holiday End Date",
      "default": "2025-12-31",
      "info": "Format: YYYY-MM-DD"
    },
    {
      "type": "header",
      "content": "Manual Override (Testing)"
    },
    {
      "type": "checkbox",
      "id": "force_holiday_mode",
      "label": "Force Holiday Reviews",
      "default": false,
      "info": "Show holiday reviews regardless of date (for testing)"
    },
    {
      "type": "checkbox",
      "id": "force_real_reviews",
      "label": "Force Real Reviews",
      "default": false,
      "info": "Show real reviews regardless of date (for testing)"
    },
    {
      "type": "checkbox",
      "id": "show_debug_info",
      "label": "Show Debug Info",
      "default": false,
      "info": "Display date logic debug information at bottom of section"
    },
    {
      "type": "header",
      "content": "Holiday Section Content"
    },
    {
      "type": "inline_richtext",
      "id": "holiday_title",
      "label": "Holiday Section Title",
      "default": "What Holiday Characters Are Saying"
    },
    {
      "type": "richtext",
      "id": "holiday_description",
      "label": "Holiday Section Description",
      "default": "<p>Even the most magical characters can't resist our holiday cocktails!</p>"
    },
    {
      "type": "header",
      "content": "Real Reviews Section Content"
    },
    {
      "type": "inline_richtext",
      "id": "real_reviews_title",
      "label": "Real Reviews Section Title",
      "default": "What Our Customers Are Saying"
    },
    {
      "type": "richtext",
      "id": "real_reviews_description",
      "label": "Real Reviews Section Description",
      "default": "<p>Hear from real customers who love Spirited Hive!</p>"
    },
    {
      "type": "header",
      "content": "Display Settings"
    },
    {
      "type": "checkbox",
      "id": "circle_images",
      "label": "Use Circle Images",
      "default": true
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 200,
      "step": 10,
      "default": 60
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 200,
      "step": 10,
      "default": 60
    },
    {
      "type": "select",
      "id": "colors",
      "label": "Color Scheme",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "1",
          "label": "First"
        },
        {
          "value": "2",
          "label": "Second"
        },
        {
          "value": "3",
          "label": "Third"
        }
      ],
      "default": "default"
    }
  ],
  "blocks": [
    {
      "type": "holiday_character",
      "name": "Holiday Character Review",
      "settings": [
        {
          "type": "text",
          "id": "character_name",
          "label": "Character Name",
          "default": "The Grinch"
        },
        {
          "type": "image_picker",
          "id": "character_image",
          "label": "Character Avatar"
        },
        {
          "type": "range",
          "id": "stars",
          "label": "Star Rating",
          "min": 1,
          "max": 5,
          "default": 5
        },
        {
          "type": "richtext",
          "id": "review_text",
          "label": "Review Text",
          "default": "<p>\"I had too many of these... but then my heart grew three sizes! ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê\"</p>"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (Optional)"
        }
      ]
    },
    {
      "type": "real_review",
      "name": "Real Customer Review",
      "settings": [
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer Name"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Customer Photo (Optional)"
        },
        {
          "type": "range",
          "id": "stars",
          "label": "Star Rating",
          "min": 1,
          "max": 5,
          "default": 5
        },
        {
          "type": "richtext",
          "id": "testimonial_text",
          "label": "Review Text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (Optional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Holiday Reviews",
      "category": "Holiday Campaign",
      "blocks": [
        {
          "type": "holiday_character",
          "settings": {
            "character_name": "The Grinch",
            "stars": 1,
            "review_text": "<p>\"I had too many of these...\"</p>"
          }
        },
        {
          "type": "holiday_character",
          "settings": {
            "character_name": "The Grinch (Later)",
            "stars": 5,
            "review_text": "<p>\"Actually, these made my heart grow three sizes! Best holiday drink ever!\"</p>"
          }
        },
        {
          "type": "holiday_character",
          "settings": {
            "character_name": "Santa Claus",
            "stars": 5,
            "review_text": "<p>\"The elves have been requesting these nonstop in the workshop! Ho ho ho!\"</p>"
          }
        },
        {
          "type": "holiday_character",
          "settings": {
            "character_name": "Rudolph",
            "stars": 5,
            "review_text": "<p>\"Yo, this Hive stuff is FIRE! Better than carrots, no cap! ü¶å\"</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
